version: '3.8'
services:
  cache:
    image: redis:6.2-alpine
    restart: always
    ports:
      - '6379:6379'
    command: redis-server --save 20 1 --loglevel warning --requirepass eYVX7EwVmmxKPCDmwMtyKVge8oLd2t81
    volumes: 
      - cache:/data
  api:
    depends_on:      
      - cache    
    build: .
    container_name: "redis_proxy_cache"
    volumes:
      - .:/src
    ports:
      - "8000:8000"
    environment:
      - CACHE_SIZE=3
      - CACHE_EXPIRY=20
      - REDIS_HOST="127.0.0.1"
      - REDIS_PORT=6379
      - REDIS_POLLSIZE=1
      - PROXY_HOST="127.0.0.1"
      - PROXY_PORT=8000
    links:      
      - cache
volumes:
  cache:
    driver: local